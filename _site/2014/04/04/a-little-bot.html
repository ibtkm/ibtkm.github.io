<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>a little but useful (for me) bot</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">py4_ blog.</a></h1>
            <p class="description"> tail -f /var/log/mind </p>
          </div>

          <h2 class="post_title"><a href=>a little but useful (for me) bot</a></h2>
<p class="meta">04 Apr 2014</p>

<div class="post">
<p>many of you are movie geeks and are usually interested in some particular genres. you might like &quot;drama&quot; or somebody else might like &quot;thriller&quot; and etc. the scenario
that I&#39;m gonna talk about has happened to you undoubtedly. you have a bunch of movies in a directory and now you wanna watch one but you don&#39;t know them all. thus, you decide to go to imdb and start to search the titles one by one. gazed to the screen, you start to read about genres, score and description and at the end you choose one. seems ok. today, as a result of not having enough of fun, I defined a little challenge for my self: automating this process through an imdb bot.<br>
I didn&#39;t find the imdb&#39;s REST api so I did the process through web interactions.
I wrote a little script in Ruby language with the help of our friend, &quot;nokogiri&quot; gem to handle the html parsing. you can get it through its <a href="http://github.com/py4/mifb">github page</a>. <br>
here is a screenshot of what it brings for you: <br>
<img src="http://ubuntuone.com/4pRtSgL6PQSxDCIg9qJV7W" width="750px" height="300px">
here is the source: <br></p>

<div class="highlight"><pre><code class="ruby"><span class="nb">require</span> <span class="s1">&#39;nokogiri&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;open-uri&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;colorize&#39;</span>
<span class="n">blacklist</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;dvdrip&quot;</span><span class="p">,</span><span class="s2">&quot;xvid&quot;</span><span class="p">,</span><span class="s2">&quot;maxspeed&quot;</span><span class="p">,</span><span class="s2">&quot;720p&quot;</span><span class="p">,</span><span class="s2">&quot;hd&quot;</span><span class="o">]</span>
<span class="nb">puts</span> <span class="s2">&quot;Enter the directory: &quot;</span>
<span class="n">dir_addr</span> <span class="o">=</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span>
<span class="n">names</span> <span class="o">=</span> <span class="no">Dir</span><span class="o">.</span><span class="n">entries</span><span class="p">(</span><span class="n">dir_addr</span><span class="p">)</span><span class="o">.</span><span class="n">reject</span> <span class="p">{</span> <span class="o">|</span><span class="nb">name</span><span class="o">|</span> <span class="nb">name</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span> <span class="ow">or</span> <span class="nb">name</span> <span class="o">==</span> <span class="s2">&quot;..&quot;</span> <span class="p">}</span>
<span class="n">names</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="o">|</span>
    <span class="nb">name</span><span class="o">.</span><span class="n">downcase!</span>
    <span class="n">blacklist</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">black_name</span><span class="o">|</span> <span class="nb">name</span><span class="o">.</span><span class="n">gsub!</span><span class="p">(</span><span class="n">black_name</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">name</span><span class="o">.</span><span class="n">include?</span> <span class="n">black_name</span> <span class="p">}</span>
    <span class="nb">name</span> <span class="o">=</span> <span class="nb">name</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/[^A-Za-z\s]/</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;http://www.imdb.com/find?q=</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">&amp;s=all&quot;</span><span class="p">))</span>
    <span class="n">section</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s2">&quot;div.findSection&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">section</span><span class="o">|</span> <span class="n">section</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s2">&quot;h3.findSectionHeader&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;Titles&quot;</span> <span class="p">}</span><span class="o">.</span><span class="n">first</span>
    <span class="n">relative_url</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s2">&quot;table.findList&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s2">&quot;tr&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s2">&quot;td.result_text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;http://www.imdb.com</span><span class="si">#{</span><span class="n">relative_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
    <span class="nb">puts</span> <span class="s2">&quot;&gt;&gt;&gt; </span><span class="si">#{</span><span class="n">doc</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s2">&quot;h1.header&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s2">&quot;span.itemprop&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2"> &lt;&lt;&lt;&quot;</span><span class="o">.</span><span class="n">red</span>
    <span class="nb">print</span> <span class="s2">&quot;genre: &quot;</span><span class="o">.</span><span class="n">green</span>
    <span class="nb">print</span> <span class="n">doc</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s2">&quot;div.infobar&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s2">&quot;span.itemprop&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span> <span class="p">}</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="nb">print</span> <span class="s2">&quot;rating: &quot;</span><span class="o">.</span><span class="n">green</span>
    <span class="nb">puts</span> <span class="n">doc</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s2">&quot;div.star-box-giga-star&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="nb">print</span> <span class="s2">&quot;description: &quot;</span><span class="o">.</span><span class="n">green</span>
    <span class="nb">puts</span> <span class="n">doc</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s2">&quot;td#overview-top&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span> <span class="nb">p</span><span class="o">.</span><span class="n">attributes</span><span class="o">[</span><span class="s2">&quot;itemprop&quot;</span><span class="o">]</span> <span class="ow">and</span> <span class="nb">p</span><span class="o">.</span><span class="n">attributes</span><span class="o">[</span><span class="s2">&quot;itemprop&quot;</span><span class="o">].</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;description&quot;</span> <span class="p">}</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">text</span>
<span class="k">end</span>
</code></pre></div>

<p>Your comments and suggestions are welcome.</p>

</div>

<div class="comments">
    <div id="disqus_thread"></div>
        <script type="text/javascript">
                    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                            var disqus_shortname = 'ibtkmblog'; // required: replace example with your forum shortname

                                    /* * * DON'T EDIT BELOW THIS LINE * * */
                                            (function() {
                                                            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                                                                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                                                                                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                                                                                            })();
                                                                                                </script>
                                                                                                    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                                                                                                        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                                                                                                            
</div>


          <div class="footer">
            <div class="contact">
							<p>
								Proudly powered by <a href="http://jekyllrb.com/">Jekyll</a> static blog generator under Emacs with a cup of tea. Copyright © 2013.<br>
                                Fork <a href="http://github.com/py4">me</a> on github or follow <a href="https://twitter.com/py4m_">me</a> on twitter or check out my personal <a href="http://py4.ir">blog</a>.
							</p>
            </div>
          </div>
        </div>

    </body>
</html>
